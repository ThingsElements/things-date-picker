<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../things-input-field/things-input-field.html">
<link rel="import" href="things-date-picker-dialog.html">

<!--
`<things-date-picker>` Things Date Picker

  Example
    
    <things-date-picker 
      label="Date Picker" 
      locale="ko" 
      read-format="YYYY-MM-DD">
    </things-date-picker>

@demo demo/index.html
-->
<dom-module id="things-date-picker">
  <template>
    <style>
      things-input-field::shadow input{
        @apply(--things-input);
        width:calc(65% - 37px);
      }
      paper-icon-button.clear{
        @apply(--things-small-icon);
        margin-right:7px;margin-left:-27px;
        opacity:.4;
        position:relative;
        top:-2px;
      }
      paper-icon-button.picker{
        @apply(--things-picker-button);
        background:url(/images/icon-resource-select.png) 55% -97px no-repeat var(--paper-blue-grey-300);
        top:1px;
      }
    </style>

    <things-input-field 
      label="[[label]]"
      type="text"
      name="[[name]]"
      value="[[value]]"
      validator="[[validator]]"
      auto-validate="[[autoValidate]]"
      error-message="[[errorMessage]]"
      readonly>
    </things-input-field>
    <paper-icon-button class="clear" icon="clear" on-tap="clearField"></paper-icon-button>
    <paper-icon-button class="picker" on-tap="openDatePicker"></paper-icon-button>
  </template>

  <script>
    Polymer({
      is: 'things-date-picker',

      properties: {

        /**
         * Date picker의 기준이 되는 locale을 설정한다.
         */
        locale: {
          type: String,
          value: 'en'
        },

        /**
         * date의 읽기전용 format을 설정한다.
         */
        readFormat: {
          type: String,
          value: 'YYYY-MM-DD'
        },

        /**
         * date의 쓰기전용 format을 설정한다.
         */
        writeFormat: {
          type: String,
          value: 'YYYY-MM-DD'
        },

        /**
         * date value
         */
        value: {
          type: String,
          notify: true
        },

        /**
         * input field에서 사용할 validator name
         */
        validator: {
          type: String
        },

        /**
         * input field의 auto vaidation 여부
         */
        autoValidate: {
          type: Boolean,
          value: false
        },

        /**
         * validation 오류시 출력되는 error message
         */
        errorMessage: {
          type: String
        }
      },

      /**
       * 버튼 클릭시 Date picker를 dialog 타입으로 나타나게 한다.
       */
      openDatePicker: function() {
        var dataObj = {
          owner: this,
          date: (this.value) ? new Date(this.value) : new Date()
        };

        var event = {};
        event.dataObj = dataObj;
        event.callback = this._applySelectedDate;

        this.fire('things-date-picker-toggle', event);
      },

      /**
       * things-date-picker-dialog에 전달할 callback 함수
       */
      _applySelectedDate: function(dataObj) {
        this.value = dataObj.date;
      },

      /**
       * 초기화된 데이터를 제거하는 기능
       */
      clearField: function() {
        this.value = '';
      }
    });
  </script>
</dom-module>
